const bind=function(b,d){return function(){return b.apply(d,arguments)}},extend=function(b,d){function f(){this.constructor=b}for(var g in d)hasProp.call(d,g)&&(b[g]=d[g]);return f.prototype=d.prototype,b.prototype=new f,b.__super__=d.prototype,b},hasProp={}.hasOwnProperty,slice=[].slice;Const=function(){function b(){}return b.xy="xy",b.yz="yz",b.xz="xz",b.xyz="xyz",b.identical=-1,b.right=3,b.bottom_right=4,b.bottom=5,b.bottom_left=6,b.left=7,b.top_left=0,b.top=1,b.top_right=2,b.sideLabels=["identical","right","bottom right","bottom","bottom left","left","top left","top","top right"],b.epsilon=1e-4,b.pi=Math.PI,b.two_pi=6.283185307179586,b.half_pi=1.5707963267948966,b.quarter_pi=.7853981633974483,b.one_degree=.017453292519943295,b.rad_to_deg=57.29577951308232,b.deg_to_rad=.017453292519943295,b.gravity=9.81,b.newton=.10197,b.gaussian=.3989422804014327,b}(),this.Const=Const,Matrix=function(){function b(){}return b.rotateAnchor2D=function(d,f,g){var j,k,l;return null==g&&(g=Const.xy),j=f.get2D(g),k=Math.cos(d),l=Math.sin(d),[k,l,0,-l,k,0,j.x*(1-k)+j.y*l,j.y*(1-k)-j.x*l,1]},b.reflectAnchor2D=function(d,f){var g,j,k,l;return null==f&&(f=Const.xy),k=d.intercept(f),g=2*Math.atan(k.slope),j=Math.cos(g),l=Math.sin(g),[j,l,0,l,-j,0,-k.yi*l,k.yi+k.yi*j,1]},b.shearAnchor2D=function(d,f,g,j){var k,l,m;return null==j&&(j=Const.xy),k=g.get2D(j),l=Math.tan(d),m=Math.tan(f),[1,l,0,m,1,0,-k.y*m,-k.x*l,1]},b.scaleAnchor2D=function(d,f,g,j){var k;return null==j&&(j=Const.xy),k=g.get2D(j),[d,0,0,0,f,0,-k.x*d+k.x,-k.y*f+k.y,1]},b.scale2D=function(d,f){return[d,0,0,0,f,0,0,0,1]},b.shear2D=function(d,f){return[1,Math.tan(d),0,Math.tan(f),1,0,0,0,1]},b.rotate2D=function(d,f){return[d,f,0,-f,d,0,0,0,1]},b.translate2D=function(d,f){return[1,0,0,0,1,0,d,f,1]},b.transform2D=function(d,f,g,j){var k,l,m;return null==g&&(g=Const.xy),null==j&&(j=!1),k=d.get2D(g),l=k.x*f[0]+k.y*f[3]+f[6],m=k.x*f[1]+k.y*f[4]+f[7],k.x=l,k.y=m,k=k.get2D(g,!0),j?k:(d.set(k),d)},b}(),this.Matrix=Matrix,Space=function(){function b(d){null==d&&(d="space"),this.id=d,this.size=new Vector,this.center=new Vector,this._timePrev=0,this._timeDiff=0,this._timeEnd=-1,this.items={},this._animID=-1,this._animCount=0,this._animPause=!1,this._refresh=!0}return b.prototype.refresh=function(d){return this._refresh=d,this},b.prototype.render=function(){return this},b.prototype.resize=function(){},b.prototype.clear=function(){},b.prototype.add=function(d){var f;if(null==d.animate||"function"!=typeof d.animate)throw"a player object for Space.add must define animate()";return f=this._animCount++,this.items[f]=d,d.animateID=f,null!=d.onSpaceResize&&d.onSpaceResize(this.size.x,this.size.y),this},b.prototype.remove=function(d){return delete this.items[d.animateID],this},b.prototype.removeAll=function(){return this.items={},this},b.prototype.play=function(d){var f;if(null==d&&(d=0),this._animID=requestAnimationFrame(function(g){return function(j){return g.play(j)}}(this)),!this._animPause){this._timeDiff=d-this._timePrev;try{this._playItems(d)}catch(g){throw f=g,cancelAnimationFrame(this._animID),console.error(f.stack),f}return this._timePrev=d,this}},b.prototype._playItems=function(d){var f,g,j;for(f in this._refresh&&this.clear(),g=this.items,g)j=g[f],j.animate(d,this._timeDiff,this.ctx);return 0<=this._timeEnd&&d>this._timeEnd&&cancelAnimationFrame(this._animID),this},b.prototype.pause=function(d){return null==d&&(d=!1),this._animPause=!d||!this._animPause,this},b.prototype.resume=function(){return this._animPause=!1,this},b.prototype.stop=function(d){return null==d&&(d=0),this._timeEnd=d,this},b.prototype.playTime=function(d){return null==d&&(d=5e3),this.play(),this.stop(d)},b.prototype.bindCanvas=function(d,f){return this.space.addEventListener?this.space.addEventListener(d,f):void 0},b.prototype.bindMouse=function(d){return null==d&&(d=!0),this.space.addEventListener&&this.space.removeEventListener?d?(this.space.addEventListener("mousedown",this._mouseDown.bind(this)),this.space.addEventListener("mouseup",this._mouseUp.bind(this)),this.space.addEventListener("mouseover",this._mouseOver.bind(this)),this.space.addEventListener("mouseout",this._mouseOut.bind(this)),this.space.addEventListener("mousemove",this._mouseMove.bind(this))):(this.space.removeEventListener("mousedown",this._mouseDown.bind(this)),this.space.removeEventListener("mouseup",this._mouseUp.bind(this)),this.space.removeEventListener("mouseover",this._mouseOver.bind(this)),this.space.removeEventListener("mouseout",this._mouseOut.bind(this)),this.space.removeEventListener("mousemove",this._mouseMove.bind(this))):void 0},b.prototype.bindTouch=function(d){return null==d&&(d=!0),this.space.addEventListener&&this.space.removeEventListener?d?(this.space.addEventListener("touchstart",this._mouseDown.bind(this)),this.space.addEventListener("touchend",this._mouseUp.bind(this)),this.space.addEventListener("touchmove",function(f){return function(g){return g.preventDefault(),f._mouseMove(g)}}(this)),this.space.addEventListener("touchcancel",this._mouseOut.bind(this))):(this.space.removeEventListener("touchstart",this._mouseDown.bind(this)),this.space.removeEventListener("touchend",this._mouseUp.bind(this)),this.space.removeEventListener("touchmove",this._mouseMove.bind(this)),this.space.removeEventListener("touchcancel",this._mouseOut.bind(this))):void 0},b.prototype.touchesToPoints=function(d,f){var g;return null==f&&(f="touches"),d&&d[f]?function(){var j,k,l,m;for(l=d[f],m=[],j=0,k=l.length;k>j;j++)g=l[j],m.push(new Vector(g.pageX-this.boundRect.left,g.pageY-this.boundRect.top));return m}.call(this):[]},b.prototype._mouseAction=function(d,f){var g,j,k,l,m,p,q,v,w;if(f.touches||f.changedTouches){for(j in m=this.items,q=[],m)w=m[j],null==w.onTouchAction?q.push(void 0):(g=f.changedTouches&&0<f.changedTouches.length,k=g?f.changedTouches.item(0).pageX:0,l=g?f.changedTouches.item(0).pageY:0,q.push(w.onTouchAction(d,k,l,f)));return q}for(j in p=this.items,v=[],p)w=p[j],null==w.onMouseAction?v.push(void 0):(k=f.offsetX||f.layerX,l=f.offsetY||f.layerY,v.push(w.onMouseAction(d,k,l,f)));return v},b.prototype._mouseDown=function(d){return this._mouseAction("down",d),this._mdown=!0},b.prototype._mouseUp=function(d){return this._mouseAction("up",d),this._mdrag&&this._mouseAction("drop",d),this._mdown=!1,this._mdrag=!1},b.prototype._mouseMove=function(d){return this._mouseAction("move",d),this._mdown?(this._mdrag=!0,this._mouseAction("drag",d)):void 0},b.prototype._mouseOver=function(d){return this._mouseAction("over",d)},b.prototype._mouseOut=function(d){return this._mouseAction("out",d),this._mdrag&&this._mouseAction("drop",d),this._mdrag=!1},b}(),this.Space=Space,CanvasSpace=function(b){function d(f,g,j){null==f&&(f="pt_space"),null==g&&(g=!1),null==j&&(j="2d"),this._resizeHandler=bind(this._resizeHandler,this),d.__super__.constructor.apply(this,arguments),this.space=document.querySelector("#"+this.id),this.bound=null,this.boundRect={top:0,left:0,width:0,height:0},this.pixelScale=1,this.appended=!0,this.space||(this.space=document.createElement("canvas"),this.space.setAttribute("id",this.id),this.appended=!1),this._mdown=!1,this._mdrag=!1,this.bgcolor=g,this.ctx=this.space.getContext(j)}return extend(d,b),d.prototype.display=function(f,g,j){var k,l;if(null==f&&(f="#pt"),null==j&&(j=!0),!this.appended){if(this.bound=document.querySelector(f),this.boundRect=this.bound.getBoundingClientRect(),this.pixelScale=1,j&&(k=window.devicePixelRatio||1,l=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.pixelScale=k/l),!this.bound)throw"Cannot add canvas to element "+f;this.resize(this.boundRect.width,this.boundRect.height),this.autoResize(!0),this.space.parentNode!==this.bound&&this.bound.appendChild(this.space),this.appended=!0,setTimeout(function(){return this.space.dispatchEvent(new Event("ready")),g?g(this.boundRect.width,this.boundRect.height,this.space):void 0}.bind(this))}return this},d.prototype._resizeHandler=function(f){return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height,f)},d.prototype.autoResize=function(f){return null==f&&(f=!0),f?window.addEventListener("resize",this._resizeHandler):window.removeEventListener("resize",this._resizeHandler),this},d.prototype.resize=function(f,g,j){var k,l,m;for(k in f=Math.floor(f),g=Math.floor(g),this.size.set(f,g),this.center=new Vector(f/2,g/2),this.boundRect.width=f,this.boundRect.height=g,this.space.width=f*this.pixelScale,this.space.height=g*this.pixelScale,this.space.style.width=f+"px",this.space.style.height=g+"px",1!==this.pixelScale&&this.ctx.scale(this.pixelScale,this.pixelScale),m=this.items,m)l=m[k],null!=l.onSpaceResize&&l.onSpaceResize(f,g,j);return this.render(this.ctx),this},d.prototype.clear=function(f){var g;return f&&(this.bgcolor=f),g=this.ctx.fillStyle,this.bgcolor?(this.ctx.fillStyle=this.bgcolor,this.ctx.fillRect(0,0,this.size.x,this.size.y)):this.ctx.clearRect(0,0,this.size.x,this.size.y),this.ctx.fillStyle=g,this},d.prototype.animate=function(f){var g,j,k;for(g in this.ctx.save(),this._refresh&&this.clear(),j=this.items,j)k=j[g],k.animate(f,this._timeDiff,this.ctx);return 0<=this._timeEnd&&f>this._timeEnd&&cancelAnimationFrame(this._animID),this.ctx.restore(),this},d}(Space),this.CanvasSpace=CanvasSpace,DOMSpace=function(b){function d(f,g,j){null==f&&(f="pt_space"),null==g&&(g=!1),null==j&&(j="html"),this._resizeHandler=bind(this._resizeHandler,this),d.__super__.constructor.apply(this,arguments),this.space=document.querySelector("#"+this.id),this.css={width:"100%",height:"100%"},this.bound=null,this.boundRect={top:0,left:0,width:0,height:0},this.appended=!0,this.space||this._createSpaceElement(),this._mdown=!1,this._mdrag=!1,this.bgcolor=g,this.ctx={}}return extend(d,b),d.prototype._createSpaceElement=function(){return this.space=document.createElement("div"),this.space.setAttribute("id",this.id),this.appended=!1},d.prototype.setCSS=function(f,g,j){return null==j&&(j=!1),this.css[f]=j?g+"px":g,this},d.prototype.updateCSS=function(){var f,g,j,k;for(f in g=this.css,j=[],g)k=g[f],j.push(this.space.style[f]=k);return j},d.prototype.display=function(f,g){if(null==f&&(f="#pt"),!this.appended){if(this.bound=document.querySelector(f),this.boundRect=this.bound.getBoundingClientRect(),!this.bound)throw"Cannot add canvas to element "+f;this.resize(this.boundRect.width,this.boundRect.height),this.autoResize(!0),this.space.parentNode!==this.bound&&this.bound.appendChild(this.space),this.appended=!0,setTimeout(function(){return this.space.dispatchEvent(new Event("ready")),g?g(this.boundRect.width,this.boundRect.height,this.space):void 0}.bind(this))}return this},d.prototype._resizeHandler=function(f){return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height,f)},d.prototype.autoResize=function(f){return null==f&&(f=!0),f?window.addEventListener("resize",this._resizeHandler):window.removeEventListener("resize",this._resizeHandler),this},d.prototype.resize=function(f,g,j){var k,l,m;for(k in this.size.set(f,g),this.center=new Vector(f/2,g/2),m=this.items,m)l=m[k],null!=l.onSpaceResize&&l.onSpaceResize(f,g,j);return this},d.prototype.clear=function(){return this.space.innerHML=""},d.prototype.animate=function(f){var g,j,k;for(g in j=this.items,j)k=j[g],k.animate(f,this._timeDiff,this.ctx);return 0<=this._timeEnd&&f>this._timeEnd&&cancelAnimationFrame(this._animID),this},d.attr=function(f,g){var j,k,l;for(j in k=[],g)l=g[j],k.push(f.setAttribute(j,l));return k},d.css=function(f){var g,j,k;for(g in j="",f)k=f[g],k&&(j+=g+": "+k+"; ");return j},d}(Space),this.DOMSpace=DOMSpace,Form=function(){function b(d){this.space=d,this.cc=d.ctx,this.cc.fillStyle="#999",this.cc.strokeStyle="#666",this.cc.lineWidth=1,this.cc.font="11px sans-serif",this.filled=!0,this.stroked=!0,this.fontSize=11,this.fontFace="sans-serif"}return b.context=function(d){var f,g;if(g=document.getElementById(d),f=g&&g.getContext&&g.getContext("2d"),!f)throw"Cannot initiate canvas 2d context";return f},b.line=function(d,f){if(!f.p1)throw f.toString()+" is not a Pair";return d.beginPath(),d.moveTo(f.x,f.y),d.lineTo(f.p1.x,f.p1.y),d.stroke()},b.lines=function(d,f){var g,j,k,l;for(l=[],g=0,j=f.length;j>g;g++)k=f[g],l.push(b.line(d,k));return l},b.rect=function(d,f,g,j){if(null==g&&(g=!0),null==j&&(j=!1),!f.p1)throw""+(f.toString()===!a(Pair));return d.beginPath(),d.moveTo(f.x,f.y),d.lineTo(f.x,f.p1.y),d.lineTo(f.p1.x,f.p1.y),d.lineTo(f.p1.x,f.y),d.closePath(),j&&d.stroke(),g?d.fill():void 0},b.circle=function(d,f,g,j){null==g&&(g=!0),null==j&&(j=!1),d.beginPath(),d.arc(f.x,f.y,f.radius,0,Const.two_pi,!1),g&&d.fill(),j&&d.stroke()},b.arc=function(d,f,g,j,k){return d.beginPath(),d.arc(f.x,f.y,g,j,k),d.stroke()},b.triangle=function(d,f,g,j){null==g&&(g=!0),null==j&&(j=!1),d.beginPath(),d.moveTo(f.x,f.y),d.lineTo(f.p1.x,f.p1.y),d.lineTo(f.p2.x,f.p2.y),d.closePath(),g&&d.fill(),j&&d.stroke()},b.point=function(d,f,g,j,k,l){var m,p,q,v;return null==g&&(g=2),null==j&&(j=!0),null==k&&(k=!1),null==l&&(l=!1),l?(d.beginPath(),d.arc(f.x,f.y,g,0,Const.two_pi,!1)):(m=f.x-g,q=f.y-g,p=f.x+g,v=f.y+g,d.beginPath(),d.moveTo(m,q),d.lineTo(m,v),d.lineTo(p,v),d.lineTo(p,q),d.closePath()),j&&d.fill(),k&&d.stroke(),f},b.points=function(d,f,g,j,k,l){var m,p,q,v;for(null==g&&(g=2),null==j&&(j=!0),null==k&&(k=!1),null==l&&(l=!1),v=[],m=0,p=f.length;p>m;m++)q=f[m],v.push(b.point(d,q,g,j,k,l));return v},b.polygon=function(d,f,g,j,k){var l,m,p;if(null==g&&(g=!0),null==j&&(j=!0),null==k&&(k=!0),!(1>=f.length)){for(d.beginPath(),d.moveTo(f[0].x,f[0].y),m=l=1,p=f.length;p>l;m=l+=1)d.lineTo(f[m].x,f[m].y);g&&d.closePath(),j&&d.fill(),k&&d.stroke()}},b.curve=function(d,f){return b.polygon(d,f,!1,!1,!0)},b.text=function(d,f,g,j){return d.fillText(g,f.x,f.y,j)},b.prototype.fill=function(d){return this.cc.fillStyle=d?d:"transparent",this.filled=!!d,this},b.prototype.stroke=function(d,f,g){return this.cc.strokeStyle=d?d:"transparent",this.stroked=!!d,f&&(this.cc.lineWidth=f),g&&(this.cc.lineJoin=g),this},b.prototype.font=function(d,f){return null==f&&(f=this.fontFace),this.fontSize=d,this.cc.font=d+"px "+f,this},b.prototype.draw=function(d){return this.sketch(d)},b.prototype.sketch=function(d){return d.floor(),d instanceof Circle?b.circle(this.cc,d,this.filled,this.stroked):d instanceof Rectangle?b.rect(this.cc,d,this.filled,this.stroked):d instanceof Triangle?b.triangle(this.cc,d,this.filled,this.stroked):d instanceof Line||d instanceof Pair?b.line(this.cc,d):d instanceof PointSet?b.polygon(this.cc,d.points):(d instanceof Vector||d instanceof Point)&&b.point(this.cc,d),this},b.prototype.point=function(d,f,g){return null==f&&(f=2),null==g&&(g=!1),b.point(this.cc,d,f,this.filled,this.stroked,g),this},b.prototype.points=function(d,f,g){return null==f&&(f=2),null==g&&(g=!1),b.points(this.cc,d,f,this.filled,this.stroked,g),this},b.prototype.line=function(d){return b.line(this.cc,d),this},b.prototype.lines=function(d){return b.lines(this.cc,d),this},b.prototype.rect=function(d){return b.rect(this.cc,d,this.filled,this.stroked),this},b.prototype.circle=function(d){return b.circle(this.cc,d,this.filled,this.stroked),this},b.prototype.arc=function(d,f,g){return b.arc(this.cc,d,d.radius,f,g),this},b.prototype.triangle=function(d){return b.triangle(this.cc,d,this.filled,this.stroked),this},b.prototype.polygon=function(d,f){return b.polygon(this.cc,d,f,this.filled,this.stroked),this},b.prototype.curve=function(d){return b.curve(this.cc,d),this},b.prototype.text=function(d,f,g,j,k){var l;return null==g&&(g=1e3),l=new Vector(d),j&&l.add(j,0),k&&l.add(0,k),this.cc.fillText(f,l.x,l.y,g),this},b}(),this.Form=Form,Point=function(){function b(){this.copy(b.get(arguments))}return b.get=function(d){return 0<d.length?"object"==typeof d[0]?d[0]instanceof Array||0<d[0].length?{x:d[0][0]||0,y:d[0][1]||0,z:d[0][2]||0}:{x:d[0].x||0,y:d[0].y||0,z:d[0].z||0}:{x:d[0]||0,y:d[1]||0,z:d[2]||0}:{x:0,y:0,z:0}},b.prototype.quadrant=function(d,f){return null==f&&(f=Const.epsilon),d.near(this)?Const.identical:Math.abs(d.x-this.x)<f?d.y<this.y?Const.top:Const.bottom:Math.abs(d.y-this.y)<f?d.x<this.x?Const.left:Const.right:d.y<this.y&&d.x>this.x?Const.top_right:d.y<this.y&&d.x<this.x?Const.top_left:d.y>this.y&&d.x<this.x?Const.bottom_left:Const.bottom_right},b.prototype.set=function(){var f;return f=b.get(arguments),this.x=f.x,this.y=f.y,this.z=f.z,this},b.prototype.copy=function(d){return this.x=d.x,this.y=d.y,this.z=d.z,this},b.prototype.clone=function(){return new b(this)},b.prototype.toString=function(){return"Point "+this.x+", "+this.y+", "+this.z},b.prototype.toArray=function(){return[this]},b.prototype.get2D=function(d,f){return null==f&&(f=!1),d===Const.xy?new this.__proto__.constructor(this):d===Const.xz?new this.__proto__.constructor(this.x,this.z,this.y):d===Const.yz?f?new this.__proto__.constructor(this.z,this.x,this.y):new this.__proto__.constructor(this.y,this.z,this.x):new this.__proto__.constructor(this)},b.prototype.min=function(){var f;return f=b.get(arguments),this.x=Math.min(this.x,f.x),this.y=Math.min(this.y,f.y),this.z=Math.min(this.z,f.z),this},b.prototype.$min=function(){var f;return f=b.get(arguments),new this.__proto__.constructor(Math.min(this.x,f.x),Math.min(this.y,f.y),Math.min(this.z,f.z))},b.prototype.max=function(){var f;return f=b.get(arguments),this.x=Math.max(this.x,f.x),this.y=Math.max(this.y,f.y),this.z=Math.max(this.z,f.z),this},b.prototype.$max=function(){var f;return f=b.get(arguments),new this.__proto__.constructor(Math.max(this.x,f.x),Math.max(this.y,f.y),Math.max(this.z,f.z))},b.prototype.equal=function(){var f;return f=b.get(arguments),f.x===this.x&&f.y===this.y&&f.z===this.z},b.prototype.near=function(d,f){var g;return null==f&&(f=Const.epsilon),g=b.get(arguments),Math.abs(g.x-this.x)<f&&Math.abs(g.y-this.y)<f&&Math.abs(g.z-this.z)<f},b.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},b.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},b}(),this.Point=Point,Vector=function(b){function d(){d.__super__.constructor.apply(this,arguments)}return extend(d,b),d.prototype._getArgs=function(f){return"number"==typeof f[0]&&1<f.length?f:f[0]},d.prototype.add=function(){var g;return"number"==typeof arguments[0]&&1===arguments.length?(this.x+=arguments[0],this.y+=arguments[0],this.z+=arguments[0]):(g=Point.get(arguments),this.x+=g.x,this.y+=g.y,this.z+=g.z),this},d.prototype.$add=function(){var g;return g=this._getArgs(arguments),new d(this).add(g)},d.prototype.subtract=function(){var g;return"number"==typeof arguments[0]&&1===arguments.length?(this.x-=arguments[0],this.y-=arguments[0],this.z-=arguments[0]):(g=Point.get(arguments),this.x-=g.x,this.y-=g.y,this.z-=g.z),this},d.prototype.$subtract=function(){var g;return g=this._getArgs(arguments),new d(this).subtract(g)},d.prototype.multiply=function(){var g;return 1===arguments.length&&("number"==typeof arguments[0]||"object"==typeof arguments[0]&&1===arguments[0].length)?(this.x*=arguments[0],this.y*=arguments[0],this.z*=arguments[0]):(g=Point.get(arguments),this.x*=g.x,this.y*=g.y,this.z*=g.z),this},d.prototype.$multiply=function(){var g;return g=this._getArgs(arguments),new d(this).multiply(g)},d.prototype.divide=function(){var g;return 1===arguments.length&&("number"==typeof arguments[0]||"object"==typeof arguments[0]&&1===arguments[0].length)?(this.x/=arguments[0],this.y/=arguments[0],this.z/=arguments[0]):(g=Point.get(arguments),this.x/=g.x,this.y/=g.y,this.z/=g.z),this},d.prototype.$divide=function(){var g;return g=this._getArgs(arguments),new d(this).divide(g)},d.prototype.magnitude=function(){var g,j,k,l,m,p;return k={x:this.x*this.x,y:this.y*this.y,z:this.z*this.z},p=1<=arguments.length&&!arguments[arguments.length-1],g=p?function(q){return q}:Math.sqrt,0===arguments.length?g(k.x+k.y+k.z):("string"==typeof arguments[0]?(j=arguments[0],m=1<arguments.length&&arguments[1]?this.$subtract(arguments[1]):void 0):(m=this.$subtract(arguments[0]),j=!1),l=m?{x:m.x*m.x,y:m.y*m.y,z:m.z*m.z}:k,m&&!j?g(l.x+l.y+l.z):j===Const.xy?g(l.x+l.y):j===Const.yz?g(l.y+l.z):j===Const.xz?g(l.x+l.z):void 0)},d.prototype.normalize=function(){return this.set(this.$normalize()),this},d.prototype.$normalize=function(){var f;return f=this.magnitude(),0===f?new d:new d(this.x/f,this.y/f,this.z/f)},d.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},d.prototype.dot=function(f,g){return null==g&&(g=Const.xyz),g===Const.xyz?this.x*f.x+this.y*f.y+this.z*f.z:g===Const.xy?this.x*f.x+this.y*f.y:g===Const.yz?this.y*f.y+this.z*f.z:g===Const.xz?this.x*f.x+this.z*f.z:this.x*f.x+this.y*f.y+this.z*f.z},d.prototype.projection=function(f,g){var j,k,l,m;return null==g&&(g=Const.xyz),m=f.magnitude(),j=this.$normalize(),k=new d(f.x/m,f.y/m,f.z/m),l=j.dot(k,g),j.$multiply(m*l)},d.prototype.cross=function(f){return new d(this.y*f.z-this.z*f.y,this.z*f.x-this.x*f.z,this.x*f.y-this.y*f.x)},d.prototype.bisect=function(f,g){return null==g&&(g=!1),g?this.$add(f).divide(2):this.$normalize().add(f.$normalize()).divide(2)},d.prototype.perpendicular=function(f){switch(null==f&&(f=Const.xy),f){case Const.xy:return[new d(-this.y,this.x,this.z),new d(this.y,-this.x,this.z)];case Const.yz:return[new d(this.x,-this.z,this.y),new d(this.x,this.z,-this.y)];case Const.xz:return[new d(-this.z,this.y,this.x),new d(this.z,-this.y,this.x)];default:return[new d(-this.y,this.x,this.z),new d(this.y,-this.x,this.z)];}},d.prototype.isPerpendicular=function(f,g){return null==g&&(g=Const.xyz),0===this.dot(f,g)},d.prototype.surfaceNormal=function(f){return this.cross(f).normalize(!0)},d.prototype.moveBy=function(){var g,j,k,l,m;for(j=Point.get(arguments),m=this.toArray(),g=0,k=m.length;k>g;g++)l=m[g],l.add(j);return this},d.prototype.rotate2D=function(f,g,j){var k,l,m,p,q;for(null==j&&(j=Const.xy),g||(g=new Point(0,0,0)),m=Matrix.rotateAnchor2D(f,g,j),q=this.toArray(),k=0,l=q.length;l>k;k++)p=q[k],Matrix.transform2D(p,m,j);return this},d.prototype.clone=function(){return new d(this)},d}(Point),this.Vector=Vector,Color=function(b){function d(){d.__super__.constructor.apply(this,arguments),this.alpha=4<=arguments.length?Math.min(1,Math.max(arguments[3],0)):1,this.mode=5<=arguments.length?arguments[4]:"rgb"}return extend(d,b),d.XYZ={D65:{x:95.047,y:100,z:108.883}},d}(Vector),this.Color=Color,Pair=function(b){function d(){d.__super__.constructor.apply(this,arguments),this.p1=new Vector(this.x,this.y,this.z),4===arguments.length?(this.z=0,this.p1.set(arguments[2],arguments[3])):6===arguments.length&&this.p1.set(arguments[3],arguments[4],arguments[5])}return extend(d,b),d.prototype.to=function(){return this.p1=new Vector(Point.get(arguments)),this},d}(Vector),this.Pair=Pair,Line=function(b){function d(){d.__super__.constructor.apply(this,arguments)}return extend(d,b),d.prototype.getDistanceFromPoint=function(f){var g,j;return j=this.$subtract(this.p1),g=new Vector(-j.y,j.x).normalize(),this.$subtract(f).dot(g)},d.prototype.getPerpendicularFromPoint=function(f,g){var j;return null==g&&(g=!0),j=this.p1.$subtract(this).projection(f.$subtract(this)),g?j.add(this):j},d}(Pair),this.Line=Line;